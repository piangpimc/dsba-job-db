import firebase_adminfrom firebase_admin import credentials, dbfrom datetime import datetime, timedelta# Initialize Firebasedef init_firebase():    if not firebase_admin._apps:        cred = credentials.Certificate("firebase_config.json")        firebase_admin.initialize_app(cred, {            'databaseURL': 'https://dsba-interviews-default-rtdb.europe-west1.firebasedatabase.app/'        })# ✅ Save a new submission under a unique ID per userdef save_submission(email, data):    ref = db.reference("submissions")    user_ref = ref.child(email.replace(".", "_"))    user_ref.push(data)  # ← this preserves multiple submissions per user# ✅ Check if user has at least one valid submission in the last 7 daysdef has_valid_submission(email):    ref = db.reference("submissions")    submissions = ref.child(email.replace(".", "_")).get()    if submissions:        for entry in submissions.values():            if isinstance(entry, dict) and "submitted_at" in entry:                try:                    submitted_time = datetime.fromisoformat(entry["submitted_at"])                    if datetime.utcnow() - submitted_time < timedelta(days=7):                        return True                except Exception:                    continue    return False# ✅ Get all submissions across all usersdef get_all_submissions():    ref = db.reference("submissions")    all_data = ref.get()    all_submissions = []    if all_data:        for user_entries in all_data.values():            if isinstance(user_entries, dict):                for submission in user_entries.values():                    if isinstance(submission, dict):                        all_submissions.append(submission)    return all_submissions# ✅ Manual override (for people you want to grant access manually)def is_manually_approved(email):    ref = db.reference("manual_access")    return ref.child(email.replace(".", "_")).get() == True# ✅ Let someone request access manuallydef request_access(email):    ref = db.reference("access_requests")    ref.child(email.replace(".", "_")).set({        "email": email,        "requested_at": datetime.utcnow().isoformat()    })